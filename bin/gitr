#!/bin/bash

COMMAND=""
CMD=$1
DIRECTORIES=$(ls -1)

if [ $# -lt 1 ] ; then
	echo "Usage: gitr <command>"
	echo "Supported commands : status,pull,push"
	exit 0
fi

shift

if [ $# -gt 0 ] ; then
	DIRECTORIES=$*
fi

# Analyzing command
case "$CMD" in
"stat" | "status")
	COMMAND="status"
	;;
"pull")
	COMMAND="pull"
	;;
"push")
	COMMAND="push"
	;;
*)
	echo "Git command not supported"
	exit 0
esac

# Executing command recursively
I=0
for dir in $DIRECTORIES ; do
	if [[ $I -gt 0 ]] ; then
		echo -e "\n\e[1m--------------------------------------------------\e[0m"
	fi
	cd $dir
	if [ -d ".git" ] ; then
		echo -e "\e[1m$dir\e[0m: \e[92mgit $COMMAND\e[0m"
		git $COMMAND
	else
		echo -e "\e[1m$dir\e[0m: \e[93mnot a git repository\e[0m"
	fi
	cd - >/dev/null
	I=$(($I+1))
done
